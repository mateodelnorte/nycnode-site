extends ../../layouts/default

include ../../mixins/video-youtube

block head
	meta(property="og:site_name" content="NYCNode.com")
	meta(property="og:url" content="http://www.nycnode.com/videos/" + video.key)
	meta(property="og:title" content=video.title)
	meta(property="og:image" content=video.images.thumbnail.mobile)
	meta(property="og:type" content="video.movie")
	meta(property="og:description" content=video.description)

	meta(property="al:ios:url" content="vnd.youtube://www.youtube.com/watch?v=HZtlJ6Owdi8&amp;feature=applinks")

	meta(property="al:android:url" content="vnd.youtube://www.youtube.com/watch?v=HZtlJ6Owdi8&amp;feature=applinks")
	meta(property="al:android:app_name" content="YouTube")
	meta(property="al:android:package" content="com.google.android.youtube")
	meta(property="al:web:url" content="http://www.nycnode.com/videos/" + video.key)

	meta(property="og:type" content="video")
	meta(property="og:video:url" content="http://www.nycnode.com/videos/" + video.key)
	meta(property="og:video:secure_url" content="http://www.nycnode.com/videos/" + video.key)
	meta(property="og:video:type" content="text/html")
	meta(property="og:video:width" content="1280")
	meta(property="og:video:height" content="720")
	meta(property="og:video:url" content="http://www.nycnode.com/videos/" + video.key)
	//- meta(property="og:video:secure_url" content="https://www.youtube.com/v/HZtlJ6Owdi8?version=3&amp;autohide=1")
	meta(property="og:video:type" content="application/x-shockwave-flash")
	meta(property="og:video:width" content="1280")
	meta(property="og:video:height" content="720")

	meta(property="og:video:tag" content="nycnode.com")
	meta(property="og:video:tag" content="nycnode")
	meta(property="og:video:tag" content="node.js")
	meta(property="og:video:tag" content="nodejs")
	meta(property="og:video:tag" content="node")
	meta(property="og:video:tag" content="javascript")
	meta(property="og:video:tag" content="programming")

	meta(property="fb:app_id" content="546372752220147")

	meta(name="twitter:card" content="player")
	meta(name="twitter:site" content="@nycnode")
	meta(name="twitter:url" content="http://www.nycnode.com/videos/" + video.key)
	meta(name="twitter:title" content=video.title)
	meta(name="twitter:description" content=video.description)
	meta(name="twitter:image" content=video.images.thumbnail.mobile)
	meta(name="twitter:app:name:iphone" content="NYCNode")
	meta(name="twitter:app:name:ipad" content="NYCNode")
	meta(name="twitter:app:name:googleplay" content="NYCNode")
	meta(name="twitter:player" content="http://www.nycnode.com/videos/" + video.key)
	meta(name="twitter:player:width" content="1280")
	meta(name="twitter:player:height" content="720")

block content
	.container
		a(href='/videos').text-muted &larr; Back to all videos
		article.full-post
			if ! video
				h2 Invalid video
			else
				header
					
					+video(video)

					//- sharing buttons
				.col-sm-12
					.share-buttons
						span.share-button
							.fb-share-button(data-href="http://www.nycnode.com/videos/" + video.key, data-colorscheme="light", data-layout="button_count", data-action="like", data-show-faces="false", data-send="false")
							//- .fb-share-button(data-href="https://developers.facebook.com/docs/plugins/" data-layout="button_count" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse">Share</a></div>
						span.share-button
							.fb-like(data-href="http://www.nycnode.com/videos/" + video.key, data-colorscheme="light", data-layout="button_count", data-action="like", data-show-faces="false", data-send="false")
						span.share-button
							a(href="https://twitter.com/share", data-via="NYCNode", data-hashtags="nycnode", data-count="button", data-dnt="true").twitter-share-button Tweet
						span.share-button
							.g-plusone(data-size="medium")
				//- != video.content.full
				//- 
				//- Comment
				//- 	.comments
				//- 		h4.mb-1=video.comments.length == 0 ? 'Be the first to reply' : plural(video.comments.length, '* comment', '* comments')
				//- 		for comment in video.comments
				//- 			if comment.author
				//- 				.comment.media
				//- 					.pull-left
				//- 						img(src=comment.author.photo ? comment.author._.photo.thumbnail(60,60) : '/images/placeholders/user-60x60.jpg', alt=comment.author.name.full, width=40, height=40).media-object.img-circle
				//- 					.media-body
				//- 						h6.mt-0
				//- 							=comment.author.name.full
				//- 							span.text-muted  &middot; #{moment(comment.publishedOn).fromNow()}
				//- 						!=comment.content.html
				//- 	if user
				//- 		//- Reply form
				//- 		form(method='post').comment-form.mt-5
				//- 			input(type='hidden', name='action', value='create-comment')
				//- 			.media
				//- 				.pull-left
				//- 					img(src=user.photo.exists ? user._.photo.thumbnail(60,60) : '/images/placeholders/user-60x60.jpg', alt=user.name.full, width=40, height=40).img-responsive.img-circle
				//- 				.media-body
				//- 					textarea(placeholder='Add your comment...', name='content').form-control
				//- 					.mv-1
				//- 						button(type='submit').btn.btn-success Submit
block js
	script(src='/js/common/share.js')
	script(src="https://apis.google.com/js/plusone.js")
	script.
		$(function() {
			var $allVideos = $("iframe[src^='//player.vimeo.com'], iframe[src^='//www.youtube.com'], object, embed"),
				$fluidEl = $("figure");
			$allVideos.each(function(){
				$(this)
					// jQuery .data does not work on object/embed elements
					.attr('data-aspectRatio', this.height / this.width)
					.removeAttr('height')
					.removeAttr('width');
			});
			$(window).resize(function() {
				var newWidth = $fluidEl.width();
				$allVideos.each(function() {
					var $el = $(this);
					$el
							.width(newWidth)
							.height(newWidth * $el.attr('data-aspectRatio'));
				});
			}).resize();
		});
		